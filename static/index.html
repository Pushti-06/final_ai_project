<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì VIT Study Assistant - AI Learning Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(15, 15, 30, 0.95);
            border-right: 2px solid #667eea;
            overflow-y: auto;
            padding: 20px;
            z-index: 1000;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }
        
        .logo h1 {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .logo p {
            font-size: 0.85em;
            color: #999;
        }
        
        .category {
            margin-bottom: 30px;
        }
        
        .category-title {
            font-size: 0.85em;
            color: #999;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: 1px;
        }
        
        .menu-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            color: #b0b0b0;
        }
        
        .menu-item:hover {
            background: rgba(102, 126, 234, 0.2);
            border-left-color: #667eea;
            color: #667eea;
        }
        
        .menu-item.active {
            background: rgba(102, 126, 234, 0.3);
            border-left-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }
        
        .main {
            margin-left: 280px;
            padding: 40px;
            min-height: 100vh;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }
        
        .title {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(102, 126, 234, 0.15);
            padding: 12px 20px;
            border-radius: 8px;
            border: 2px solid #667eea;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat {
            background: rgba(45, 45, 80, 0.6);
            border: 2px solid rgba(102, 126, 234, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #999;
            margin-top: 5px;
        }
        
        .content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
        }
        
        .card {
            background: rgba(45, 45, 80, 0.6);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            display: none;
        }
        
        .card.active {
            display: block;
        }
        
        .card:hover {
            border-color: #667eea;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.2);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        }
        
        .card-icon {
            font-size: 2.5em;
        }
        
        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        .card-desc {
            font-size: 0.85em;
            color: #999;
            margin-top: 3px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-size: 0.9em;
            color: #999;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(30, 30, 50, 0.8);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 0.95em;
            font-family: inherit;
            transition: all 0.3s;
            margin-bottom: 10px;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        input[type="file"]::file-selector-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #555;
            transform: none;
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            background: rgba(30, 30, 50, 0.9);
            border-left: 4px solid #667eea;
            border-radius: 8px;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result.success {
            border-left-color: #28a745;
        }
        
        .result.error {
            border-left-color: #dc3545;
        }
        
        .result-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .result-content {
            font-size: 0.95em;
            color: #d0d0d0;
            line-height: 1.6;
            word-break: break-word;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 15px;
        }
        
        .spinner {
            border: 3px solid rgba(102, 126, 234, 0.2);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading.show {
            display: block;
        }
        
        img {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }
        
        audio {
            width: 100%;
            margin-top: 15px;
        }
        
        .result-content pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }

        .prediction-item {
            background: rgba(102, 126, 234, 0.1);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }
        
        @media (max-width: 768px) {
            .sidebar { width: 200px; }
            .main { margin-left: 200px; padding: 20px; }
            .content { grid-template-columns: 1fr; }
            .stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <h1>üìö VIT</h1>
            <p>Study Assistant v2.0</p>
        </div>
        
        <div class="category">
            <div class="category-title">üí¨ Core</div>
            <div class="menu-item active" onclick="openTab(0, this)">üí¨ Chat</div>
            <div class="menu-item" onclick="openTab(1, this)">üí° Doc Q&A</div>
            <div class="menu-item" onclick="openTab(2, this)">üìÇ Upload Files</div>
        </div>
        
        <div class="category">
            <div class="category-title">üìù Text Tasks</div>
            <div class="menu-item" onclick="openTab(3, this)">üè∑Ô∏è Classification</div>
            <div class="menu-item" onclick="openTab(4, this)">üë§ NER</div>
            <div class="menu-item" onclick="openTab(5, this)">üìÑ Summarize</div>
            <div class="menu-item" onclick="openTab(6, this)">üåç Translate</div>
        </div>
        
        <div class="category">
            <div class="category-title">üñºÔ∏è Vision Tasks</div>
            <div class="menu-item" onclick="openTab(7, this)">üé® Generate Image</div>
        </div>
        
        <div class="category">
            <div class="category-title">üîä Audio Tasks</div>
            <div class="menu-item" onclick="openTab(8, this)">üîä Text-to-Speech</div>
        </div>
    </div>

    <div class="main">
        <div class="top-bar">
            <h2 class="title">AI Study Assistant</h2>
            <div class="status" id="status">
                <div class="status-dot"></div>
                <span id="statusText">Loading...</span>
            </div>
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="docCount">0</div>
                <div class="stat-label">Documents (Chunks)</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="featureCount">0</div>
                <div class="stat-label">Features</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="modelCountDisplay">0</div>
                <div class="stat-label">Models</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="statusSymbol">üî¥</div>
                <div class="stat-label">Backend Status</div>
            </div>
        </div>

        <div class="content" id="content"></div>
    </div>

    <script>
        const BASE_URL = 'http://127.0.0.1:8000';
        let currentTab = 0;

        const tasks = [
            { id: 'chat', title: 'General Chat', desc: 'Chat with the AI assistant', icon: 'üí¨', endpoint: '/chat' },
            { id: 'doc-qa', title: 'Document Q&A', desc: 'Ask questions from your documents', icon: 'üí°', endpoint: '/document-qa' },
            { id: 'upload', title: 'Upload Documents', desc: 'Add files to knowledge base', icon: 'üìÇ', endpoint: '/upload-file' },
            { id: 'text-class', title: 'Text Classification', desc: 'Classify text into categories', icon: 'üè∑Ô∏è', endpoint: '/classify-text' },
            { id: 'ner', title: 'Named Entity Recognition', desc: 'Extract people, places, organizations', icon: 'üë§', endpoint: '/ner' },
            { id: 'summarization', title: 'Text Summarization', desc: 'Summarize long texts', icon: 'üìÑ', endpoint: '/summarize' },
            { id: 'translation', title: 'Translation', desc: 'Translate text to any language', icon: 'üåç', endpoint: '/translate' },
            { id: 'txt-img', title: 'Generate Image', desc: 'Create images from text', icon: 'üé®', endpoint: '/generate-image' },
            { id: 'tts', title: 'Text to Speech', desc: 'Convert text to audio', icon: 'üîä', endpoint: '/text-to-speech' }
        ];

        function getContentHTML(idx) {
            const forms = {
                0: `<div class="input-group"><label>Your Question</label><textarea id="inp-${idx}" placeholder="Ask me anything..."></textarea></div>`,
                1: `<div class="input-group"><label>Question</label><input type="text" id="inp-${idx}" placeholder="Ask from uploaded documents..."></div>`,
                2: `<div class="input-group"><label>Upload File (PDF, DOCX, Image)</label><input type="file" id="inp-${idx}" accept=".pdf,.docx,image/*"></div>
                     <button onclick="clearDatabase()" style="margin-top: 10px; background: #dc3545;">üóëÔ∏è Clear Knowledge Base</button>`,
                3: `<div class="input-group"><label>Text to Classify</label><textarea id="inp-${idx}" placeholder="Enter text..."></textarea></div>
                    <div class="input-group"><label>Labels (comma-separated)</label><input type="text" id="inp2-${idx}" placeholder="positive, negative, neutral"></div>`,
                4: `<div class="input-group"><label>Text for NER</label><textarea id="inp-${idx}" placeholder="John Smith works at Apple in New York..."></textarea></div>`,
                5: `<div class="input-group"><label>Text to Summarize</label><textarea id="inp-${idx}" placeholder="Long text..." style="min-height: 150px;"></textarea></div>`,
                6: `<div class="input-group"><label>Text (English)</label><textarea id="inp-${idx}" placeholder="Hello, how are you?"></textarea></div>
                    <div class="input-group"><label>Target Language</label><input type="text" id="inp2-${idx}" placeholder="es (Spanish), fr (French), de (German), hi (Hindi)"></div>`,
                7: `<div class="input-group"><label>Image Description</label><textarea id="inp-${idx}" placeholder="A futuristic city at sunset..."></textarea></div>`,
                8: `<div class="input-group"><label>Text to Speak</label><textarea id="inp-${idx}" placeholder="Enter text to convert to speech..."></textarea></div>`
            };
            return forms[idx] + `<button onclick="call(${idx})">‚ñ∂Ô∏è Execute</button>`;
        }

        function createCard(idx) {
            const t = tasks[idx];
            return `
                <div class="card" id="card-${idx}">
                    <div class="card-header">
                        <div class="card-icon">${t.icon}</div>
                        <div>
                            <div class="card-title">${t.title}</div>
                            <div class="card-desc">${t.desc}</div>
                        </div>
                    </div>
                    <div id="content-${idx}">${getContentHTML(idx)}</div>
                    <div class="loading" id="load-${idx}"><div class="spinner"></div></div>
                    <div class="result" id="result-${idx}"></div>
                </div>
            `;
        }

        function renderContent() {
            document.getElementById('content').innerHTML = tasks.map((_, i) => createCard(i)).join('');
            openTab(0, document.querySelector('.menu-item.active'));
        }

        function openTab(idx, el) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(`card-${idx}`)?.classList.add('active');
            el?.classList.add('active');
            currentTab = idx;
        }

        async function call(idx) {
            const task = tasks[idx];
            const inp = document.getElementById(`inp-${idx}`);
            const inp2 = document.getElementById(`inp2-${idx}`);
            const loading = document.getElementById(`load-${idx}`);
            const result = document.getElementById(`result-${idx}`);

            loading.classList.add('show');
            result.classList.remove('show', 'success', 'error');

            try {
                const fd = new FormData();
                
                // Form data mapping
                const formMappings = {
                    0: () => fd.append('question_text', inp.value),
                    1: () => fd.append('question_text', inp.value),
                    2: () => { if (!inp.files[0]) throw new Error("Select file"); fd.append('uploaded_file', inp.files[0]); },
                    3: () => { fd.append('text', inp.value); fd.append('labels', inp2.value); },
                    4: () => fd.append('text', inp.value),
                    5: () => fd.append('text', inp.value),
                    6: () => { fd.append('text', inp.value); fd.append('source_lang', 'en'); fd.append('target_lang', inp2.value || 'es'); },
                    7: () => fd.append('prompt', inp.value),
                    8: () => fd.append('text', inp.value)
                };

                formMappings[idx]?.();
                
                const res = await fetch(BASE_URL + task.endpoint, { method: 'POST', body: fd });
                const data = await res.json();

                if (!res.ok) throw new Error(data.detail || `Error ${res.status}`);

                // Display results
                let html = '<div class="result-title">‚úÖ Result</div><div class="result-content">';

                if (data.image_url) {
                    html += `<p><strong>Prompt:</strong> ${data.prompt}</p><img src="${BASE_URL}${data.image_url}">`;
                } else if (data.audio_url) {
                    html += `<p><strong>Text:</strong> ${data.text || '...'}</p><audio controls src="${BASE_URL}${data.audio_url}"></audio>`;
                } else if (data.summary) {
                    html += `<p><strong>Summary:</strong> ${data.summary}</p>`;
                } else if (data.translation) {
                    html += `<p><strong>Original (${data.source_language || 'EN'}):</strong> ${data.original}</p>
                             <p><strong>Translation (${data.target_language || 'Target'}):</strong> ${data.translation}</p>`;
                } else if (data.answer !== undefined) {
                    html += `<p><strong>Answer:</strong> ${data.answer}</p>${data.source ? `<p class="card-desc" style="margin-top:10px;">Source: ${data.source}</p>` : ''}`;
                } else if (data.entities && Array.isArray(data.entities)) {
                    html += '<p><strong>Entities:</strong></p>';
                    data.entities.forEach(e => {
                        html += `<div class="prediction-item"><strong>${e.entity_group || e.entity}</strong>: ${e.word} (${(e.score * 100).toFixed(1)}%)</div>`;
                    });
                } else if (data.classification) {
                    html += '<p><strong>Classification:</strong></p>';
                    if (data.classification.labels && data.classification.scores) {
                        data.classification.labels.forEach((label, i) => {
                            html += `<div class="prediction-item"><strong>${label}</strong>: ${(data.classification.scores[i] * 100).toFixed(2)}%</div>`;
                        });
                    } else {
                        html += `<pre>${JSON.stringify(data.classification, null, 2)}</pre>`;
                    }
                } else if (data.message && data.chunks_added !== undefined) {
                    html += `<p><strong>‚úÖ Upload Success!</strong></p>
                             <p>${data.message}</p>
                             <p><strong>Files in Knowledge Base:</strong> ${data.learned_files.join(', ')}</p>`;
                    updateHealth();
                } else if (data.message) {
                    html += `<p><strong>Message:</strong> ${data.message}</p>`;
                } else {
                    html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                }

                html += '</div>';
                result.innerHTML = html;
                result.classList.add('show', 'success');

            } catch (e) {
                console.error("API Error:", e);
                result.innerHTML = `<div class="result-title">‚ùå Error</div><div class="result-content">${e.message || "Unexpected error occurred"}</div>`;
                result.classList.add('show', 'error');
            } finally {
                loading.classList.remove('show');
            }
        }

        async function clearDatabase() {
            if (!confirm("‚ö†Ô∏è Clear all documents from knowledge base? This cannot be undone!")) return;

            const loading = document.getElementById(`load-2`);
            const result = document.getElementById(`result-2`);
            loading.classList.add('show');
            result.classList.remove('show', 'success', 'error');

            try {
                const res = await fetch(BASE_URL + '/clear-database', { method: 'DELETE' });
                const data = await res.json();

                if (!res.ok) throw new Error(data.detail || `Error ${res.status}`);

                result.innerHTML = `<div class="result-title">‚úÖ Success</div><div class="result-content">${data.message}</div>`;
                result.classList.add('show', 'success');
                updateHealth();
            } catch (e) {
                result.innerHTML = `<div class="result-title">‚ùå Error</div><div class="result-content">Failed: ${e.message}</div>`;
                result.classList.add('show', 'error');
            } finally {
                loading.classList.remove('show');
            }
        }

        async function updateHealth() {
            try {
                const res = await fetch(BASE_URL + '/health');
                const data = await res.json();

                document.getElementById('docCount').textContent = data.documents_loaded;
                
                // Count total features from all categories
                let totalFeatures = 0;
                if (data.features && typeof data.features === 'object') {
                    Object.values(data.features).forEach(arr => {
                        if (Array.isArray(arr)) totalFeatures += arr.length;
                    });
                } else if (Array.isArray(data.features)) {
                    totalFeatures = data.features.length;
                }
                document.getElementById('featureCount').textContent = totalFeatures;
                
                document.getElementById('modelCountDisplay').textContent = Object.keys(data.models || {}).length;

                const isHealthy = data.status === 'healthy' && data.token_status && data.token_status.includes('configured');
                
                document.getElementById('statusText').textContent = isHealthy ? '‚úÖ Backend Ready' : '‚ö†Ô∏è Warning';
                document.getElementById('statusSymbol').textContent = isHealthy ? 'üü¢' : 'üü°';
                document.querySelector('.status-dot').style.backgroundColor = isHealthy ? '#28a745' : '#ffc107';

            } catch (e) {
                console.error("Health check failed:", e);
                document.getElementById('statusText').textContent = '‚ùå Backend Offline';
                document.getElementById('statusSymbol').textContent = 'üî¥';
                document.querySelector('.status-dot').style.backgroundColor = '#dc3545';
            }
        }

        // Initialize
        renderContent();
        updateHealth();
        setInterval(updateHealth, 10000);
    </script>
</body>
</html>